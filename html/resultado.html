<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="../style.css">
    <style>
        #caixaEstabelecimento .caixaBarbearia {
            min-width: 300px;
        }
    </style>
</head>

<body>
    <header>
        <nav>
            <ul>
                <!-- <li><a href="#" class="links">Conta</a></li> -->
            </ul>
        </nav>
    </header>
    <main>
        <div id="caixaEstabelecimento"></div>
    </main>
    <footer>
        <a href="#"><img src="../img/icons/github.png" alt=""><span>GitHub</span></a>
        <p>Lorem ipsum, dolor sit amet consectetur adipisicing elit.</p>
    </footer>
    <script src="../script.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', async () => {
            try {
                // container principal que vai receber TODAS as barbearias
                const container = document.getElementById('caixaEstabelecimento');

                // requisita os dados do PHP
                const resposta = await fetch('../php/exibir.php');
                const dados = await resposta.json();

                if (!dados || dados.length === 0) {
                    container.innerHTML = 'Nenhum estabelecimento encontrado';
                    return;
                }

                // percorre cada barbearia retornada
                dados.forEach(e => {
                    // NOVO: cria uma nova div para cada barbearia (antes pegava sempre o mesmo elemento)
                    const caixaGeral = document.createElement("div");
                    caixaGeral.classList.add("caixaGeral");
                    
                    // evento de clique
                    caixaGeral.onclick = () => {
                        caixaGeral.classList.toggle("active");
                        caixaInvisivel.classList.toggle("active");
                    };

                    const caixa = document.createElement("div");
                    caixa.classList.add("caixaBarbearia");

                    // imagem principal (logo)
                    const foto = document.createElement("img");
                    foto.classList.add("fotoBarbearia");

                    // se o PHP já devolve o caminho completo
                    foto.src = e.logo;
                    // se ele devolve só o nome do arquivo, use:
                    // foto.src = "../img/" + e.logo;
                    foto.alt = e.nome_estabelecimento;

                    // nome
                    const nome = document.createElement("p");
                    nome.classList.add("nomeEstabelecimento");
                    nome.innerText = e.nome_estabelecimento;

                    // avaliação
                    const avaliacao = document.createElement("div");
                    avaliacao.classList.add("avaliacao");

                    const nota = document.createElement("img");
                    nota.src = "../img/icons/avaliacao.png";
                    avaliacao.appendChild(nota);

                    // bloco de informações
                    const caixaInformacoes = document.createElement("div");
                    caixaInformacoes.classList.add("caixaInformacoes");

                    // localização
                    const localizacao = document.createElement("p");
                    localizacao.classList.add("localizacao");
                    localizacao.innerText = "Localização: " + e.localizacao;

                    // contato
                    const contato = document.createElement("p");
                    contato.classList.add("contato")
                    contato.innerText = "Contato: " + e.telefone_estabelecimento;

                    // apresentação
                    const caixaInvisivel = document.createElement("p");
                    caixaInvisivel.classList.add("caixaInvisivel");

                    // imagem adicional
                    const fotoExtra = document.createElement("img");
                    fotoExtra.src = e.foto; // ou "../img/" + e.foto;
                    fotoExtra.alt = "Foto do local";
                    fotoExtra.classList.add("fotoBarbearia");

                    // apresentação
                    const sinopse = document.createElement("p");
                    sinopse.classList.add("sinopse");
                    sinopse.innerText = e.apresentacao || "Sem descrição disponível.";

                    // seta
                    const seta = document.createElement("img");
                    seta.src = "../img/icons/seta.png";
                    seta.classList.add("seta");

                    // montagem final
                    caixaInformacoes.appendChild(nome);
                    caixaInformacoes.appendChild(avaliacao);
                    caixaInformacoes.appendChild(localizacao);
                    caixaInformacoes.appendChild(contato);
                    caixaInvisivel.appendChild(fotoExtra);
                    caixaInvisivel.appendChild(sinopse);
                    caixa.appendChild(foto);
                    caixa.appendChild(caixaInformacoes);
                    caixa.appendChild(seta);
                    caixaGeral.appendChild(caixa);
                    caixaGeral.appendChild(caixaInvisivel);

                    // NOVO: adiciona a caixa criada ao container principal
                    container.appendChild(caixaGeral);
                });
            } catch (error) {
                console.error('Erro ao pegar os dados da sessão ', error);
            }
        });
    </script>
</body>

</html>